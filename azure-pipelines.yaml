name: Xamarin.Android.Tools $(Rev:r)
jobs:
- job: windows
  displayName: windows
  pool: Hosted VS2017
  steps:
  - task: NuGetCommand@2
    displayName: 'NuGet restore'
    inputs:
      restoreSolution: Xamarin.Android.Tools.sln
  - task: MSBuild@1
    displayName: 'Build solution Xamarin.Android.Tools.sln'
    inputs:
      solution: Xamarin.Android.Tools.sln
  - task: NuGetCommand@2
    displayName: 'NuGet install NUnit3TestAdapter'
    inputs:
      command: custom
      arguments: 'install NUnit3TestAdapter -Version 3.10.0 -OutputDirectory packages'
  - task: VSTest@2
    displayName: 'VsTest - NUnit3'
    inputs:
      testAssemblyVer2: 'bin\TestDebug\*-Tests.dll'
      pathtoCustomTestAdapters: 'packages\NUnit3TestAdapter.3.10.0\build\net35'
  - task: NuGetCommand@2
    displayName: NuGet pack
    inputs:
      command: pack
      packagesToPack: src\Xamarin.Android.Tools.AndroidSdk\Xamarin.Android.Tools.AndroidSdk.nuspec
  - task: NuGetCommand@2
    displayName: NuGet push
    inputs:
      command: push
      publishVstsFeed: '3d20c03e-99cb-4c71-a5bd-70bfca6a78cb'
- job: mac
  displayName: mac
  pool: Hosted macOS
  steps:
  - task: NuGetCommand@2
    displayName: 'NuGet restore'
    inputs:
      restoreSolution: Xamarin.Android.Tools.sln
  - task: MSBuild@1
    displayName: 'Build solution Xamarin.Android.Tools.sln'
    inputs:
      solution: Xamarin.Android.Tools.sln
  - task: NuGetCommand@2
    displayName: NuGet install NUnit.Console
    inputs:
      command: custom
      arguments: install NUnit.Console -Version 3.9.0 -OutputDirectory packages
  - script: mono packages/NUnit.ConsoleRunner.3.9.0/tools/nunit3-console.exe bin/TestDebug/Xamarin.Android.Tools.AndroidSdk-Tests.dll
    displayName: Run NUnit Tests
    continueOnError: true
  - task: PublishTestResults@2
    inputs:
      testResultsFormat: NUnit
      testResultsFiles: TestResult.xml